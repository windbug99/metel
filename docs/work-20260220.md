# Work Plan - 2026-02-20

## 목적
- 자율 LLM 에이전트 구현 완성도 100% 달성
- Notion API 기능 구현
- Linear API 기능 구현
- 추가 요구사항 반영: 타겟 서비스/API가 없는 중간 작업(예: 3문장 요약)을 LLM 작업으로 인식하고 수행

## 오늘 작업 순서

### 1) 요구사항 잠금 및 완료 기준(DoD) 확정
- 자율 에이전트 필수 기능 확정
  - 요청 분석
  - 작업 분해(Task Decomposition)
  - 작업 분류(TOOL/API vs LLM)
  - 실행 순서/의존성 계획
  - 결과 병합/최종 응답
- DoD 확정
  - E2E 시나리오 성공:
    - "Linear의 기획 관련 이슈 검색 -> 3문장 요약(LLM) -> Notion 새 페이지 생성/저장"
- 진행상태: 완료

### 2) 에이전트 실행 모델 설계
- Task 스키마 정의
  - `type: TOOL | LLM`
  - `service`, `api`, `input`, `output_schema`, `depends_on`
- Planner/Executor 분리
  - Planner: 사용자 요청 -> Task DAG 생성
  - Executor: Task 타입별 실행기 호출
- 실패 처리 정책
  - 재시도, 부분 실패 보고, 대체 경로
- 진행상태: 완료 (Task 스키마에 TOOL/LLM 분류 추가)

### 3) LLM 작업 실행기(LLM Worker) 구현
- API 없이 수행 가능한 작업 전담 실행기 구현
- 예시 작업 템플릿
  - "주어진 이슈 목록을 한국어 3문장으로 요약"
- 출력 검증
  - 정확히 3문장 검증
  - 검증 실패 시 재생성/재시도
- 진행상태: 1차 완료 (문장 수 강제 보정 로직 포함)

### 4) Linear API 구현/연결
- 인증(OAuth) 점검
- 이슈 검색 구현(키워드/필터/페이지네이션)
- 에러 표준화 및 에이전트 Tool 인터페이스 연결
- 진행상태: 1차 완료 (핵심 4개 + teams/list, issue update, comment create 구현/테스트 통과)

### 5) Notion API 구현/연결
- 인증 점검
- 페이지 생성/저장 구현(타이틀/본문)
- 에이전트 Tool 인터페이스 연결
- 진행상태: 1차 완료 (OAuth 도구 보완 + 데이터소스 조회->LLM 요약->페이지 생성 오케스트레이션 반영)

### 6) 오케스트레이션 통합
- Task1(TOOL): Linear 이슈 조회
- Task2(LLM): 3문장 요약
- Task3(TOOL): Notion 페이지 생성
- Task 출력 -> 후속 Task 입력 자동 매핑
- 진행상태: 완료 (Task 기반 공통 오케스트레이션 일반화 반영)

### 7) E2E 테스트 및 안정화
- 정상 시나리오
- 경계 케이스
  - 이슈 0건
  - 이슈 과다
  - LLM 요약 실패 재시도
- 장애 케이스
  - OAuth/권한/레이트리밋
- 실행 로그
  - Task 분류 결과, 입력/출력, 실패 원인
- 진행상태: 완료 (테스트 통과)

### 8) 문서화 및 마감
- 에이전트 분류 규칙/검증/재시도 정책 문서화
- `.env.example` 및 실행 가이드 최신화
- 체크리스트 완료 상태 업데이트
- 진행상태: 완료 (최종 완료 체크 반영)

## 작업 중 참조 규칙
- 오늘 작업 중 본 문서를 기준 계획으로 사용
- 구현/테스트 진행 시 실제 결과를 반영해 항목 상태를 수시 업데이트

## 구현 메모 (실시간)
- `AgentPlan`에 `tasks` 필드 추가, `AgentTask` 타입 신설
- Planner/LLM Planner에서 `TOOL | LLM` Task 자동 생성/정규화
- Executor에 `plan.tasks` 기반 공통 오케스트레이터 추가 (TOOL/LLM 의존 순서 실행)
- Telegram 결과 메시지에 `작업 분해(TOOL/LLM)` 섹션 추가
- Linear 도구 확장: `linear_list_teams`, `linear_update_issue`, `linear_create_comment`
- Linear executor 확장: 팀 조회/댓글 생성/이슈 수정 의도 파싱 및 실행 경로 추가
- Notion OAuth 도구 보완: `notion_oauth_token_exchange/introspect/revoke` Basic 인증 실행 지원
- Notion 데이터소스 Task 오케스트레이션 보강:
  - Planner: 데이터소스 질의 Task 자동 분해
  - Executor: `notion_query_data_source` 출력을 LLM 입력으로 연결 후 생성 페이지 본문 주입
- 테스트 실행 결과:
  - 최신 재검증 합계: 95 passed
  - 전체 백엔드 테스트: 116 passed, 5 skipped, 1 warning
- 라이브 E2E 실행 스크립트 추가: `backend/scripts/run_agent_live_e2e.py`
  - dry run: `cd backend && source .venv/bin/activate && python scripts/run_agent_live_e2e.py --dry-run`
  - 실제 실행: `cd backend && source .venv/bin/activate && python scripts/run_agent_live_e2e.py --user-id <USER_ID> --data-source-id <DATA_SOURCE_ID>`
- 실환경 실행 결과:
  - `linear_to_notion_summary`: 성공
  - `notion_data_source_to_notion_summary`: 유효 `data_source_id`로 재실행 성공(데이터소스 쿼리 호출 확인)
- 최종 상태:
  - 백엔드 테스트: `116 passed, 5 skipped, 1 warning`
  - DoD 시나리오 검증 완료
  - 문서 삭제는 사용자 명시 지시 후 수행

## 종료 규칙
- 사용자 명시 지시 후에만 `docs/work-20260220.md` 삭제
